/*! gatekeeper.js - v0.0.1 - 2012-12-20
* Copyright (c) 2012 HIRAKI Satoru; Licensed MIT */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;return l=void 0,f=0,a=0,u={},s={},r=function(e,t){var n;return n=Object.prototype.toString.call(t).slice(8,-1),t!=null&&n===e?!0:!1},i=function(t){return l?l:(t.matches&&(l=t.matches),t.webkitMatchesSelector&&(l=t.webkitMatchesSelector),l||(l=e.matchesSelector),l)},c=function(e,t,n){if(t==="_root")return n;if(e===n)return;if(i(e).call(e,t))return e;if(e.parentNode)return f++,c(e.parentNode,t,n)},t=function(e,t,n,r){return u[e.id]||(u[e.id]={}),u[e.id][t]||(u[e.id][t]={}),u[e.id][t][n]||(u[e.id][t][n]=[]),u[e.id][t][n].push(r)},h=function(e,t,n,r){var i,s;if(!r&&!n){u[e.id][t]={};return}if(!r){delete u[e.id][t][n];return}i=0,s=[];while(i<u[e.id][t][n].length){if(u[e.id][t][n][i]===r){u[e.id][t][n].pop(i,1);break}s.push(i++)}return s},o=function(t,n,r){var i,o,a,l,h,p,d;if(!u[t][r])return;d=n.target,p=void 0,a=void 0,l={},i=0,o=0,f=0;for(p in u[t][r])u[t][r].hasOwnProperty(p)&&(a=c(d,p,s[t].element),h=function(){return!0},a&&h(r,s[t].element,a,p==="_root",n)&&(f++,u[t][r][p].match=a,l[f]=u[t][r][p]));n.stopPropagation=function(){return n.cancelBubble=!0},i=0;while(i<=f){if(l[i]){o=0;while(o<l[i].length){if(l[i][o]!=null&&l[i][o].call(l[i].match,n)===!1){e.cancel(n);return}if(n.cancelBubble)return;o++}}i++}},n=function(n,i,s,a){var f,l,c;r("Array",n)||(n=[n]),!s&&r("Function",i)&&(s=i,i="_root"),c=this.id,f=function(e){return o(c,e,f.original)},l=void 0,l=0;while(l<n.length)f.original=n[l],(!u[this.id]||!u[this.id][n[l]])&&e.addEvent(this,n[l],f),a&&h(this,n[l],i,s),t(this,n[l],i,s),l++;return this},e=function(){function e(t,n){var r;if(!(this instanceof e)){for(r in s)if(s[r].element===t)return s[r];return a++,s[a]=new e(t,a),s[a]}this.element=t,this.id=a}return e.prototype.on=function(e,t,r){return n.call(this,e,t,r)},e.prototype.off=function(e,t,r){return n.call(this,e,t,r,!0)},e}(),e.cancel=function(e){return e.preventDefault(),e.stopPropagation()},e.addEvent=function(e,t,n){var r;return r=t==="blur"||t==="focus",e.element.addEventListener(t,n,r)},e.matchesSelector=function(){},window.Gk=e})();