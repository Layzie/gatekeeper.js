/*! gatekeeper.js - v0.0.1 - 2012-12-13
* Copyright (c) 2012 HIRAKI Satoru; Licensed MIT */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p;return c=void 0,l=0,f=0,a={},o={},t=function(e,t,n){var r;return r=t==="blur"||t==="focus",e.element.addEventListener(t,n,r)},i=function(e){return e.preventDefault(),e.stopPropagation()},s=function(t){return c?c:(t.matches&&(c=t.matches),t.webkitMatchesSelector&&(c=t.webkitMatchesSelector),c||(c=e.matchesSelector),c)},h=function(e,t,n){if(t==="_root")return n;if(e===n)return;if(s(e).call(e,t))return e;if(e.parentNode)return l++,h(e.parentNode,t,n)},n=function(e,t,n,r){return a[e.id]||(a[e.id]={}),a[e.id][t]||(a[e.id][t]={}),a[e.id][t][n]||(a[e.id][t][n]=[]),a[e.id][t][n].push(r)},p=function(e,t,n,r){var i,s;if(!r&&!n){a[e.id][event]={};return}if(!r){delete a[e.id][t][n];return}i=0,s=[];while(i<a[e.id][t][n].length){if(a[e.id][t][n][i]===r){a[e.id][t][n].pop(i,1);break}s.push(i++)}return s},u=function(t,n,r){var i,s,u,f,c,p;if(!a[t][r])return;p=n.target,c=void 0,u=void 0,f={},i=0,s=0,l=0;for(c in a[t][r])a[t][r].hasOwnProperty(c)&&(u=h(p,c,o[t].element),u&&e.matchesEvent(r,o[t].element,u,c==="_root",n)&&(l++,a[t][r][c].match=u,f[l]=a[t][r][c]));n.stopPropagation=function(){return n.cancelBubble=!0},i=0;while(i<=l){if(f[i]){s=0;while(s<f[i].length){if(f[i][s].call(f[i].match,n)===!1){e.cancel(n);return}if(n.cancelBubble)return;s++}}i++}},r=function(t,r,i,s){var o,f,l;t instanceof Array||(t=[t]),!i&&typeof r=="function"&&(i=r,r="_root"),l=this.id,o=function(e){return u(l,e,o.original)},f=void 0,f=0;while(f<t.length){o.original=t[f],(!a[this.id]||!a[this.id][t[f]])&&e.addEvent(this,t[f],o);if(s){p(this,t[f],r,i);continue}n(this,t[f],r,i),f++}return this},e=function(t,n){var r;if(this instanceof e)return this.element=t,this.id=f;for(r in o)if(o[r].element===t)return o[r];return f++,o[f]=new e(t,f),o[f]},e.prototype.on=function(e,t,n){return r.call(this,e,t,n)},e.prototype.off=function(e,t,n){return r.call(this,e,t,n,!0)},e.matchesSelector=function(){},e.cancel=i,e.addEvent=t,e.matchesEvent=function(){return!0},window.Gk=e})();