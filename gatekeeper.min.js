/*! gatekeeper.js - v0.0.1 - 2012-12-12
* Copyright (c) 2012 HIRAKI Satoru; Licensed MIT */
var __hasProp={}.hasOwnProperty;(function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;return h=void 0,c=0,l=0,f={},u={},n=function(e,t,n){var r;return r=t==="blur"||t==="focus",e.element.addEventListener(t,n,r)},s=function(e){return e.preventDefault(),e.stopPropagation()},o=function(e){return h?h:(h==null&&(h=e.matches),h==null&&(h=e.webkitMatchesSelector),h||(h=t.matchesSelector),h)},p=function(e,t,n){if(t==="root")return n;if(e===n)return;if(o(e).call(e,t))return e;if(e.parentNode)return c--,p(e.parentNode,t,n)},r=function(e,t,n,r){return f[e.id]||(f[e.id]={}),f[e.id][t]||(f[e.id][t]={}),f[e.id][t][n]||(f[e.id][t][n]=[]),f[e.id][t][n].push(r)},d=function(e,t,n,r){var i,s,o,u,a,l;if(!r&&!n){f[e.id][event]={};return}if(!r){f[e.id][t][n]=null;return}a=f[e.id][t][n],l=[];for(i=o=0,u=a.length;o<u;i=++o){s=a[i];if(f[e.id][t][n][i]===r){f[e.id][t][n].pop(i,1);break}l.push(void 0)}return l},a=function(e,n,r){var i,s,o,a,l,h,d,v,m,g,y,b,w;if(!f[e][r])return;h=n.target,a={},c=0,b=f[e][r];for(l in b){if(!__hasProp.call(b,l))continue;d=b[l],o=p(h,l,u[e].element),o&&t.matchesEvent(r,u[e].element,o,l==="_root",n)&&(c++,f[e][r][l].match=o,a[c]=f[e][r][l])}n.stopPropagation=function(){return n.cancelBubble=!0};for(v=0,g=c.length;v<g;v++){i=c[v];if(a[i]){w=a[i];for(m=0,y=w.length;m<y;m++){s=w[m];if(a[i][s].call(a[i].match,n===!1)){t.cancel(n);return}if(n.cancelBubble)return}}}},i=function(e,n,i,s){var o,u,l,c,h;e instanceof Array||(e=[e]),!i&&typeof n=="function"&&(i=n,n="_root"),l=this.id,o=function(e){return a(l,e,o.original)};for(c=0,h=e.length;c<h;c++){u=e[c],o.original=e[u],(!f[this.id]||!f[this.id][e[u]])&&t.addEvent(this,e[u],o);if(s){d(this,e[u],n,i);continue}r(this,e[u],n,i)}return this},t=function(){function e(t,n){var r,i;if(!(this instanceof e)){for(r in u){i=u[r];if(u[r].ele===t)return u[r]}return l++,u[l]=new e(t,l),u[l]}this.ele=t,this.id=l}return e.prototype.on=function(e,t,n){return i.call(this,e,t,n)},e.prototype.off=function(e,t,n){return i.call(this,e,t,n,!0)},e.prototype.matchesSelector=function(){},e.prototype.cancel=s,e.prototype.addEvent=n,e.prototype.matchesEvent=function(){return!0},e}(),e.Gk=t})(window);