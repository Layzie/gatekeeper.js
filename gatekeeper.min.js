/*! gatekeeper.js - v0.0.1 - 2012-12-25
* Copyright (c) 2012 HIRAKI Satoru; Licensed Apache License, Version 2.0 */
(function(){var e,t,n,r,i,s,o,u,a,f;return u=0,o=0,s={},r={},a=function(t,n,r){var i;i=function(t){var n;return n=void 0,n?n:(n==null&&(n=t.matches),n==null&&(n=t.webkitMatchesSelector),n||(n=e.matchesSelector),n)};if(n==="_root")return r;if(t===r)return;if(i(t).call(t,n))return t;if(t.parentNode)return u++,a(t.parentNode,n,r)},t=function(e,t,n,r){var i,o,u,a,f,l;return(a=s[u=e.id])==null&&(s[u]={}),(f=(i=s[e.id])[t])==null&&(i[t]={}),(l=(o=s[e.id][t])[n])==null&&(o[n]=[]),s[e.id][t][n].push(r)},f=function(e,t,n,r){var i,o;if(!r&&!n){s[e.id][t]={};return}if(!r){delete s[e.id][t][n];return}i=0,o=[];while(i<s[e.id][t][n].length){if(s[e.id][t][n][i]===r){s[e.id][t][n].pop(i,1);break}o.push(i++)}return o},i=function(t,n,i){var o,f,l,c,h,p,d;if(!s[t][i])return;d=n.target,h=void 0,l=void 0,c={},o=0,f=0,u=0,p=Object.keys(s[t][i]),p.forEach(function(e){var o;l=a(d,e,r[t].element),o=function(){return!0};if(l&&o(i,r[t].element,l,e==="_root",n))return u++,s[t][i][e].match=l,c[u]=s[t][i][e]}),n.stopPropagation=function(){return n.cancelBubble=!0},o=0;while(o<=u){if(c[o]){f=0;while(f<c[o].length){if(c[o][f]!=null&&c[o][f].call(c[o].match,n)===!1){e.cancel(n);return}if(n.cancelBubble)return;f++}}o++}},n=function(n,r,o,u){var a,l,c,h;a=function(e,t){var n;return n=Object.prototype.toString.call(t).slice(8,-1),t!=null&&n===e?!0:!1},a("Array",n)||(n=[n]),!o&&a("Function",r)&&(o=r,r="_root"),h=this.id,l=function(e){return i(h,e,l.original)},c=void 0,c=0;while(c<n.length)l.original=n[c],(!s[this.id]||!s[this.id][n[c]])&&e.addEvent(this,n[c],l),u&&f(this,n[c],r,o),t(this,n[c],r,o),c++;return this},e=function(){function e(t,n){var i;if(!(this instanceof e)){for(i in r)if(r[i].element===t)return r[i];return o++,r[o]=new e(t,o),r[o]}this.element=t,this.id=o}return e.prototype.on=function(e,t,r){return n.call(this,e,t,r)},e.prototype.off=function(e,t,r){return n.call(this,e,t,r,!0)},e}(),e.cancel=function(e){return e.preventDefault(),e.stopPropagation()},e.addEvent=function(e,t,n){var r;return r=t==="blur"||t==="focus",e.element.addEventListener(t,n,r)},e.matchesSelector=function(){},window.Gk=e})();